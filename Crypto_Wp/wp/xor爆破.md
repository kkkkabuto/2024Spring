# 学习xor爆破
- [GKCTF 2021]XOR
```python
from Crypto.Util.number import *
from hashlib import md5

a = getPrime(512)
b = getPrime(512)
c = getPrime(512)
d = getPrime(512)
d1 = int(bin(d)[2:][::-1] , 2)
n1 = a*b
x1 = a^b
n2 = c*d
x2 = c^d1
flag = md5(str(a+b+c+d).encode()).hexdigest()
print("n1 =",n1)
print("x1 =",x1)
print("n2 =",n2)
print("x2 =",x2)

#n1 = 83876349443792695800858107026041183982320923732817788196403038436907852045968678032744364820591254653790102051548732974272946672219653204468640915315703578520430635535892870037920414827506578157530920987388471203455357776260856432484054297100045972527097719870947170053306375598308878558204734888246779716599
#x1 = 4700741767515367755988979759237706359789790281090690245800324350837677624645184526110027943983952690246679445279368999008839183406301475579349891952257846
#n2 = 65288148454377101841888871848806704694477906587010755286451216632701868457722848139696036928561888850717442616782583309975714172626476485483361217174514747468099567870640277441004322344671717444306055398513733053054597586090074921540794347615153542286893272415931709396262118416062887003290070001173035587341
#x2 = 3604386688612320874143532262988384562213659798578583210892143261576908281112223356678900083870327527242238237513170367660043954376063004167228550592110478

```
- 先爆破出a，b，思路是异或结果为1时，(a,b)=(1,0)或者(a,b)=(0,1)；异或结果为0时，(a,b)=(0,0)或者(a,b)=(1,1)
- 普通循环爆破复杂度太高，需要迭代爆破
```python
import itertools

n1 = 83876349443792695800858107026041183982320923732817788196403038436907852045968678032744364820591254653790102051548732974272946672219653204468640915315703578520430635535892870037920414827506578157530920987388471203455357776260856432484054297100045972527097719870947170053306375598308878558204734888246779716599
x1 = 4700741767515367755988979759237706359789790281090690245800324350837677624645184526110027943983952690246679445279368999008839183406301475579349891952257846

a_list, b_list = [0], [0]

cur_mod = 1
for i in range(800):
    cur_mod *= 2
    nxt_as, nxt_bs = [], []
    for al, bl in zip(a_list, b_list):
        for ah, bh in itertools.product([0, 1], repeat=2):
            aa, bb = ah * (cur_mod // 2) + al, bh * (cur_mod // 2) + bl
            if (aa * bb % cur_mod == n1 % cur_mod) and ((aa ^ bb) == x1 % cur_mod):
                nxt_as.append(aa)
                nxt_bs.append(bb)

    a_list, b_list = nxt_as, nxt_bs

for a, b in zip(a_list, b_list):
    if a * b == n1 and a * b - n1 == 0 and (a ^ b) - x1 == 0:
        break

print(a)
print(b)

```

- 爆破c，d
```python
import itertools

n1 = 65288148454377101841888871848806704694477906587010755286451216632701868457722848139696036928561888850717442616782583309975714172626476485483361217174514747468099567870640277441004322344671717444306055398513733053054597586090074921540794347615153542286893272415931709396262118416062887003290070001173035587341

x1 = 3604386688612320874143532262988384562213659798578583210892143261576908281112223356678900083870327527242238237513170367660043954376063004167228550592110478

a_list, b_list, aa_list, bb_list = [0], [0], [0], [0]

x1_bits = [int(x) for x in f'{x1:0512b}'[::-1]]

cur_mod = 1
for i in range(256):
    cur_mod *= 2
    nxt_as, nxt_bs, nxt_aas, nxt_bbs = [], [], [], []
    for al, bl, a2, b2 in zip(a_list, b_list, aa_list, bb_list):
        for ah, bh, ah2, bh2 in itertools.product([0, 1], repeat=4):
            aa, bb, aa2, bb2 = ah*(cur_mod // 2) + al, bh*(cur_mod // 2) + bl, ah2*(cur_mod // 2) + a2, bh2*(cur_mod // 2) + b2
            bb2_rev = f'{bb2:0512b}'[::-1]
            bb2_rev = int(bb2_rev, 2)
            aa2_rev = f'{aa2:0512b}'[::-1]
            aa2_rev = int(aa2_rev, 2)

            gujie = '0' * (i+1) + '1' * (510 - 2 * i) + '0' * (i+1)
            gujie = int(gujie, 2)
            if ((aa * bb % cur_mod == n1 % cur_mod) and ((ah ^ bh2) == x1_bits[i]) and (ah2 ^ bh == x1_bits[511-i]) and ((aa2_rev + aa) * (bb2_rev + bb) <= n1) and ((aa2_rev + aa + gujie) * (bb2_rev + bb + gujie) >= n1)):
                nxt_as.append(aa)
                nxt_bs.append(bb)
                nxt_aas.append(aa2)
                nxt_bbs.append(bb2)
    
    a_list, b_list, aa_list, bb_list = nxt_as, nxt_bs, nxt_aas, nxt_bbs

for a, b, aa2, bb2 in zip(a_list, b_list, aa_list, bb_list):
    aa2_rev = f'{aa2:0512b}'[::-1]
    aa2_rev = int(aa2_rev, 2)
    bb2_rev = f'{bb2:0512b}'[::-1]
    bb2_rev = int(bb2_rev, 2)
    a = aa2_rev + a
    b = bb2_rev + b
    if (a * b == n1):
        break

print(a)
print(b)
print(a * b - n1)
print((a ^ b) - x1)

```

- flag
```python
from Crypto.Util.number import *
from hashlib import md5


a = 7836147139610655223711469747200164069484878894626166870664740637786609468164555354874619497753277560280939259937394201154154977382033483373128424196987617
b = 10703774182571073361112791376032380096360697926840362483242105878115552437021674861528714598089603406032844418758725744879476596359225265333530235803365847
c = 8046925436710204192438304055874778865895416996970843869698858865603953411170369526997784224210491769140388046960966644628154489203286940293881427188058327
d = 8113427789020078526682817916943942153489187786107307958765586032610741354289280539264853469783621315049385549884903133806294183614352084988365109630250683
flag = md5(str(a + b + c + d).encode()).hexdigest()
print(flag)
# f28ed218415356b4336e2f778f2981bb

```
